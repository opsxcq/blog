<!doctype html><html lang=en>
<head><title>How to disable page table isolation on Debian &ndash; STRM</title>
<meta name=description content="A pro-freedom hacktivist thinktank.
">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta charset=utf-8>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin=anonymous>
<link rel=stylesheet href=https://strm.sh/css/colour/strm-dark.css>
<link rel=stylesheet href=https://strm.sh/css/colour/dark-mode.css>
<link rel=stylesheet href=https://strm.sh/css/main.css>
<link rel=stylesheet href=https://strm.sh/css/custom.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
</head>
<body>
<div class=page>
<header class=page__header><h1 class=page__logo><a href=https://strm.sh class=page__logo-inner>STRM</a></h1>
<nav class="page__nav main-nav">
<ul>
<li class=main-nav__item><a class=nav-main-item href=/posts/ title>Posts</a></li>
<li class=main-nav__item><a class=nav-main-item href=/projects/ title>Projects</a></li>
<li class=main-nav__item><a class=nav-main-item href=/malware-samples/ title>Malware</a></li>
<li class=main-nav__item><a class=nav-main-item href=/studies/ title>Studies</a></li>
<li class=main-nav__item><a class=nav-main-item href=https://github.com/opsxcq/blog/discussions/3>Forum</a></li>
</ul>
</nav>
</header>
<section class=page__body>
<header class=content__header>
<h1>How to disable page table isolation on Debian</h1>
</header>
<div class=content__body>
<p>After meltdown, spectre and other similar bugs were discoreved and patched the
overall performance on Linux decreased. <a href=https://gist.github.com/bobrik/c67189e88efcc2a1491c54c15f5fe006>Here a detailed benchmark</a> about the
impact of these fixes on Redis performance. Something between <strong>15%</strong> and <strong>6%</strong> slower
than the same machine without the fixes.</p>
<h2 id=check-your-linux>Check your linux</h2>
<p>To check if the fixes are enabled run the command bellow:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>grep CONFIG_PAGE_TABLE_ISOLATION<span style=color:#f92672>=</span>y /boot/config-<span style=color:#e6db74>`</span>uname -r<span style=color:#e6db74>`</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;enabled&#34;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;disabled&#34;</span>
grep -q <span style=color:#e6db74>&#34;cpu_insecure\|cpu_meltdown\|kaiser&#34;</span> /proc/cpuinfo <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;enabled&#34;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;disabled&#34;</span>
sudo dmesg | grep -q <span style=color:#e6db74>&#34;Kernel/User page tables isolation: enabled&#34;</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;enabled&#34;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;disabled&#34;</span>
</code></pre></div><p>You can also check your system using this <a href=https://github.com/opsxcq/exploit-cve-2017-5715>exploit</a>. If your system is vulnerable
and has no fixes enabled, the output will be:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>taskset -c 1 ./exploit

[+] Testing for Spectre
[+] Dumping memory from 0xffffffffffdfeea8 to 0xffffffffffdfeec2
[+] Dumped bytes match the expected value
[+] System vulnerable to spectre
</code></pre></div><h2 id=test-before-applying>Test before applying</h2>
<p>Before testing the fixes permanently you <strong>should test them</strong>, reboot your system
and edit your <em>grub</em> configuration by pressing <strong>E</strong> and add these parameters to your
kernel.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>spectre_v2=off pti=off kpti=off
</code></pre></div><h2 id=applying-the-fix>Applying the fix</h2>
<p>To apply these configurations permanently edit your <code>/etc/default/grub</code> file and
append the parameters above to the <code>GRUB_CMDLINE_LINUX_DEFAULT</code> line. After that
just update your grub configuration with <code>sudo update-grub</code>.</p>
<h2 id=conclusion>Conclusion</h2>
<p>It is not a good idea to disable these protections on your servers, not even on
your desktop, because this bug can be exploited via Firefox for example but
sometimes you need some extra performance and are willing to accept the risk.</p>
<h2 id=references>References</h2>
<ul>
<li><a href=https://spectreattack.com/>Spectre website</a></li>
<li><a href=https://blog.mozilla.org/security/2018/01/03/mitigations-landing-new-class-timing-attack/>Firefox mitigations for Spectre</a></li>
</ul>
</div>
<footer class=content__footer></footer>
<script src=https://utteranc.es/client.js repo=opsxcq/blog issue-term=title label=comment theme=dark-blue crossorigin=anonymous async></script>
</section>
<section class=page__aside>
<div class=aside__about>
<div class=aside__about>
<h1 class=about__title>## STRM ##</h1>
<p class=about__description>A pro-freedom hacktivist thinktank.</p>
</div>
<ul class=aside__social-links>
<li>
<a href=https://github.com/opsxcq/blog rel=me aria-label=GitHub title=GitHub><i class="fab fa-github" aria-hidden=true></i></a>&nbsp;
</li>
<li>
<a href=mailto:trash-can@strm.sh rel=me aria-label=Email title=Email><i class="fas fa-envelope" aria-hidden=true></i></a>&nbsp;
</li>
<li>
<a href=https://keybase.io/terminator rel=me aria-label="Keybase OPSXCQ" title="Keybase OPSXCQ"><i class="fab fa-keybase" aria-hidden=true></i></a>&nbsp;
</li>
<li>
<a href=https://keybase.io/team/cryptoanarquismo rel=me aria-label="Keybase Crypto" title="Keybase Crypto"><i class="fas fa-users" aria-hidden=true></i></a>&nbsp;
</li>
<li>
<a href=https://keybase.io/team/deepweb rel=me aria-label="Keybase Deep Web" title="Keybase Deep Web"><i class="fas fa-users" aria-hidden=true></i></a>&nbsp;
</li>
<li>
<a href=https://github.com/opsxcq/blog/discussions/3 rel=me aria-label=Forum title=Forum><i class="fas fa-users" aria-hidden=true></i></a>&nbsp;
</li>
</ul>
</div>
<hr>
<div class=aside__content>
<p>
By [OPSXCQ],
2018-08-09
</p>
<nav id=TableOfContents>
<ul>
<li><a href=#check-your-linux>Check your linux</a></li>
<li><a href=#test-before-applying>Test before applying</a></li>
<li><a href=#applying-the-fix>Applying the fix</a></li>
<li><a href=#conclusion>Conclusion</a></li>
<li><a href=#references>References</a></li>
</ul>
</nav>
</div>
</section>
<footer class=page__footer><p class=copyright>STRM</p>
<p class=advertisement>Powered by <a href=https://github.com/opsxcq/blog>Open Source</a></p>
</footer>
</div>
</body>
</html>